@if(!episdoesSidebarVisible && studyZone){
  <button id="toggleModalButton" pButton pRipple class="p-button-rounded p-button-help" (click)="onToggleEpisodesModal()">
    <i class="pi pi-bars" style="font-size: 1.5rem;"></i>
  </button>
}
<div id="episodesModal" #episodesModal></div>
<p-sidebar [(visible)]="episdoesSidebarVisible" [appendTo]="episodesModal" [position]="'right'" [styleClass]="'floatSidebar lg:col-3 md:col-4'" [modal]="false" [blockScroll]="false">
  <ng-template pTemplate="header">Episodios de olor:</ng-template>
  @if(studyZone){
    <p-accordion [activeIndex]="episode?.id">
      @for( ep of studyZone.episodes; track ep; let index = $index){
        <p-accordionTab
        [classList]="'position-sticky'"
        [ngClass]="{'preview': index === previewEpisode?.id}"
        header="{{'Episodio ' + (index + 1)}}"
        (click)="selectEpisode(ep)"
        >
          <h6>Observaciones</h6>
          <div class="flex flex-wrap gap-1">
            @for(obs of ep.observations; track obs; let index = $index){
              <div
              class="observation"
              (click)="[ol.show($event), observationSelected(obs.id)]"
              (mouseenter)="[ol.show($event), observationPreview(obs.id)]"
              (mouseover)="ol.show($event)"
              (mouseleave)="[ol.hide(), observationPreview(null)]"
              [ngClass]="{ 'active' : obs.id === observation , 'preview' : obs.id === previewObservation && obs.id !== observation}"
              >
                <div>
                  <b>{{obs.createdAt| date:'HH:mm'}}h.</b>
                </div>
              </div>
              <p-overlayPanel #ol>
                <b>Date:</b> {{obs.createdAt| date:'dd/MM/yyyy HH:mm'}}<br/>
                <b>Type:</b> {{obs.relationships.odourSubType.relationships?.odourType?.name}}<br/>
                <b>Subtype:</b> {{obs.relationships.odourSubType.name}}<br/>
                <b>Hedonic Tone:</b> {{obs.relationships.odourHedonicTone?.name}}<br/>
                <b>Intensity:</b> {{obs.relationships.odourIntensity?.name}}<br/>
              </p-overlayPanel>
            }
          </div>
        </p-accordionTab>
      }
    </p-accordion>
  }

</p-sidebar>


